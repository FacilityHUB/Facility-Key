-- Fonction pour appliquer un UICorner
local function applyUICorner(element, cornerRadius)
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, cornerRadius)
	corner.Parent = element
end

-- Fonction pour appliquer un UIStroke
local function applyUIStroke(element)
	local stroke = Instance.new("UIStroke")
	stroke.Color = Color3.fromRGB(72, 72, 72)
	stroke.Thickness = 1
	stroke.Transparency = 0
	stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	stroke.Parent = element
end

-- Fonction pour lire une clé sauvegardée
local function loadSavedKey()
	local folderPath = "FacilityKey"
	local filePath = folderPath .. "/Key.txt"
	
	if isfile(filePath) then
		return readfile(filePath)
	else
		return nil
	end
end

-- Fonction pour sauvegarder une clé
local function saveKey(key)
	local folderPath = "FacilityKey"
	local filePath = folderPath .. "/Key.txt"
	
	if not isfolder(folderPath) then
		makefolder(folderPath)
	end
	
	writefile(filePath, key)
end

-- Charger FacilityLibrary
local FacilityLibrary = loadstring(
	game:HttpGet("https://raw.githubusercontent.com/FacilityHUB/Facility-Key/refs/heads/main/Beta/V1.0.0.0c")
)()

-- Vérifier si une clé est déjà sauvegardée et la valider
local savedKey = loadSavedKey()
if savedKey then
	local response = FacilityLibrary.validateDefaultKey(savedKey)
	if response == true then
		print("Clé sauvegardée valide : " .. savedKey)
	else
		print("Clé sauvegardée invalide, veuillez entrer une nouvelle clé.")
		savedKey = nil
	end
end

-- Création de l'interface
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FacilityKey"
screenGui.Parent = game:GetService("CoreGui")

local Container = Instance.new("Frame")
Container.Name = "Container"
Container.Size = UDim2.new(0, 471, 0.243, 0)
Container.Position = UDim2.new(0.491, 0, 0.322, 0)
Container.BackgroundColor3 = Color3.fromRGB(24, 24, 24)
Container.Parent = screenGui
applyUICorner(Container, 8)

local Titre = Instance.new("TextLabel")
Titre.Size = UDim2.new(0, 479, 0, 30)
Titre.Position = UDim2.new(0, 0, 0.038, 0)
Titre.Text = "Facility Key"
Titre.TextColor3 = Color3.fromRGB(93, 93, 93)
Titre.BackgroundTransparency = 1
Titre.Font = Enum.Font.SourceSansBold
Titre.TextScaled = true
Titre.Parent = Container

local Fermerbtn = Instance.new("TextButton")
Fermerbtn.Name = "Fermerbtn"
Fermerbtn.Text = "X"
Fermerbtn.Position = UDim2.new(0.94, 0, 0, 0)
Fermerbtn.Size = UDim2.new(0, 28, 0, 29)
Fermerbtn.BackgroundTransparency = 1
Fermerbtn.TextColor3 = Color3.fromRGB(118, 118, 118)
Fermerbtn.TextScaled = true
Fermerbtn.Font = Enum.Font.SourceSansBold
Fermerbtn.Parent = Container

local EnterBox = Instance.new("Frame")
EnterBox.Name = "EnterBox"
EnterBox.Size = UDim2.new(0, 350, 0, 32)
EnterBox.Position = UDim2.new(0.136, 0, 0.257, 0)
EnterBox.BackgroundColor3 = Color3.fromRGB(39, 39, 39)
EnterBox.Parent = Container
applyUICorner(EnterBox, 8)
applyUIStroke(EnterBox)

local EnterKey = Instance.new("TextBox")
EnterKey.Name = "EnterKey"
EnterKey.Text = savedKey or "Enter Key"
EnterKey.Size = UDim2.new(0, 349, 0, 31)
EnterKey.Position = UDim2.new(0.003, 0, 0, 0)
EnterKey.BackgroundTransparency = 1
EnterKey.TextColor3 = Color3.fromRGB(170, 170, 170)
EnterKey.TextSize = 12
EnterKey.Parent = EnterBox

local Discord = Instance.new("Frame")
Discord.Name = "Frame"
Discord.Size = UDim2.new(0, 101, 0, 33)
Discord.Position = UDim2.new(0.66, 0, 0.464, 0)
Discord.BackgroundColor3 = Color3.fromRGB(47, 47, 47)
Discord.Parent = Container
applyUICorner(Discord, 8)
applyUIStroke(Discord)

local DiscordBTN = Instance.new("TextButton")
DiscordBTN.Name = "Frame"
DiscordBTN.Text = "Discord"
DiscordBTN.Size = UDim2.new(0, 100, 0, 33)
DiscordBTN.Position = UDim2.new(0.02, 0, 0, 0)
DiscordBTN.BackgroundTransparency = 1
DiscordBTN.TextColor3 = Color3.fromRGB(99, 99, 99)
DiscordBTN.TextSize = 12
DiscordBTN.Parent = Discord

local GetKey = Instance.new("Frame")
GetKey.Name = "Frame"
GetKey.Size = UDim2.new(0, 101, 0, 33)
GetKey.Position = UDim2.new(0.136, 0, 0.464, 0)
GetKey.BackgroundColor3 = Color3.fromRGB(47, 47, 47)
GetKey.Parent = Container
applyUICorner(GetKey, 8)
applyUIStroke(GetKey)

local GetKeyBTN = Instance.new("TextButton")
GetKeyBTN.Name = "Frame"
GetKeyBTN.Text = "Get Key"
GetKeyBTN.Size = UDim2.new(0, 100, 0, 33)
GetKeyBTN.Position = UDim2.new(0.01, 0, 0, 0)
GetKeyBTN.BackgroundTransparency = 1
GetKeyBTN.TextColor3 = Color3.fromRGB(99, 99, 99)
GetKeyBTN.TextSize = 12
GetKeyBTN.Parent = GetKey

local Validate = Instance.new("Frame")
Validate.Name = "Validate"
Validate.Size = UDim2.new(0, 101, 0, 33)
Validate.Position = UDim2.new(0.399, 0, 0.464, 0)
Validate.BackgroundColor3 = Color3.fromRGB(47, 47, 47)
Validate.Parent = Container
applyUICorner(Validate, 8)
applyUIStroke(Validate)

local ValidateBTN = Instance.new("TextButton")
ValidateBTN.Name = "ValidateBTN"
ValidateBTN.Text = "Validate"
ValidateBTN.Size = UDim2.new(0, 100, 0, 33)
ValidateBTN.Position = UDim2.new(0.01, 0, 0, 0)
ValidateBTN.BackgroundTransparency = 1
ValidateBTN.TextColor3 = Color3.fromRGB(99, 99, 99)
ValidateBTN.TextSize = 12
ValidateBTN.Parent = Validate

-- Fermer le GUI
Fermerbtn.MouseButton1Click:Connect(function()
	screenGui:Destroy()
end)

-- Ajouter un événement au bouton ValidateBTN
ValidateBTN.MouseButton1Click:Connect(function()
	local enteredKey = EnterKey.Text -- Récupérer la clé entrée dans EnterKey
	if enteredKey == "" or enteredKey == "Enter Key" then
		warn("Veuillez entrer une clé valide.")
		return
	end

	-- Valider la clé
	local response = FacilityLibrary.validateDefaultKey(enteredKey)
	if response == true then
		print("Clé valide : " .. enteredKey)
		saveKey(enteredKey) -- Sauvegarder la clé validée
	else
		print("Clé invalide : " .. enteredKey)
	end
end)

-- Retourner les éléments dans une table
return {
	ValidateBTN = ValidateBTN,
	EnterKey = EnterKey,
	FacilityLibrary = FacilityLibrary
}
