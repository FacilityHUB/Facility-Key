local function applyUICorner(element, cornerRadius)
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, cornerRadius)
	corner.Parent = element
end

local function applyUIStroke(element)
	local stroke = Instance.new("UIStroke")
	stroke.Color = Color3.fromRGB(72, 72, 72)
	stroke.Thickness = 1
	stroke.Transparency = 0
	stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	stroke.Parent = element
end

local function loadSavedKey()
	local folderPath = "FacilityKey"
	local filePath = folderPath .. "/Key.txt"

	if isfile(filePath) then
		return readfile(filePath)
	else
		return nil
	end
end

local function saveKey(key)
	local folderPath = "FacilityKey"
	local filePath = folderPath .. "/Key.txt"

	if not isfolder(folderPath) then
		makefolder(folderPath)
	end

	writefile(filePath, key)
end

local FacilityLibrary = loadstring(
	game:HttpGet("https://raw.githubusercontent.com/FacilityHUB/Facility-Key/refs/heads/main/Beta/V1.0.0.0c")
)()

local savedKey = loadSavedKey()
if savedKey then
	local response = FacilityLibrary.validateDefaultKey(savedKey)
	if response == true then
		print("Saved key Valid : " .. savedKey)
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = "Facility Key",
			Text = "Saved key Valid : " .. savedKey,
			Icon = "rbxassetid://1234567890",
		})
		screenGui:Destroy()
	else
		print("Invalid saved key, please enter a new key.")
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = "Facility Key",
			Text = "Invalid saved key, please enter a new key .",
			Icon = "rbxassetid://1234567890",
		})
		savedKey = nil
	end
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FacilityKey"
screenGui.Parent = game:GetService("CoreGui")

local Container = Instance.new("Frame")
Container.Name = "Container"
Container.Size = UDim2.new(0, 471, 0.243, 0)
Container.Position = UDim2.new(0.491, 0, 0.322, 0)
Container.BackgroundColor3 = Color3.fromRGB(24, 24, 24)
Container.Parent = screenGui
applyUICorner(Container, 8)
applyUIStroke(Container)

local Titre = Instance.new("TextLabel")
Titre.Size = UDim2.new(0, 479, 0, 30)
Titre.Position = UDim2.new(0, 0, 0.038, 0)
Titre.Text = "Facility Key"
Titre.TextColor3 = Color3.fromRGB(93, 93, 93)
Titre.BackgroundTransparency = 1
Titre.Font = Enum.Font.SourceSansBold
Titre.TextScaled = true
Titre.Parent = Container

local Fermerbtn = Instance.new("TextButton")
Fermerbtn.Name = "Fermerbtn"
Fermerbtn.Text = "X"
Fermerbtn.Position = UDim2.new(0.94, 0, 0, 0)
Fermerbtn.Size = UDim2.new(0, 28, 0, 29)
Fermerbtn.BackgroundTransparency = 1
Fermerbtn.TextColor3 = Color3.fromRGB(118, 118, 118)
Fermerbtn.TextScaled = true
Fermerbtn.Font = Enum.Font.SourceSansBold
Fermerbtn.Parent = Container

local Preventions = Instance.new("TextLabel")
Preventions.Position = UDim2.new(0.129, 0, 0.691, 0)
Preventions.Size = UDim2.new(0, 349, 0, 50)
Preventions.Name = "Frame"
Preventions.BackgroundTransparency = 1
Preventions.TextColor3 = Color3.fromRGB(100, 100, 100)
Preventions.Text =
	'To obtain your key, click on "Get Key". Then, enter your key in the "TextBox". For assistance, join the Discord by clicking on "Discord".'
Preventions.TextScaled = true
Preventions.TextWrapped = true
Preventions.Parent = Container

local EnterBox = Instance.new("Frame")
EnterBox.Name = "EnterBox"
EnterBox.Size = UDim2.new(0, 350, 0, 32)
EnterBox.Position = UDim2.new(0.136, 0, 0.257, 0)
EnterBox.BackgroundColor3 = Color3.fromRGB(39, 39, 39)
EnterBox.Parent = Container
applyUICorner(EnterBox, 8)
applyUIStroke(EnterBox)

local EnterKey = Instance.new("TextBox")
EnterKey.Name = "EnterKey"
EnterKey.Text = savedKey or "Enter Key"
EnterKey.Size = UDim2.new(0, 349, 0, 31)
EnterKey.Position = UDim2.new(0.003, 0, 0, 0)
EnterKey.BackgroundTransparency = 1
EnterKey.TextColor3 = Color3.fromRGB(170, 170, 170)
EnterKey.TextSize = 12
EnterKey.Parent = EnterBox

local Discord = Instance.new("Frame")
Discord.Name = "Frame"
Discord.Size = UDim2.new(0, 101, 0, 33)
Discord.Position = UDim2.new(0.66, 0, 0.464, 0)
Discord.BackgroundColor3 = Color3.fromRGB(47, 47, 47)
Discord.Parent = Container
applyUICorner(Discord, 8)
applyUIStroke(Discord)

local DiscordBTN = Instance.new("TextButton")
DiscordBTN.Name = "Frame"
DiscordBTN.Text = "Discord"
DiscordBTN.Size = UDim2.new(0, 100, 0, 33)
DiscordBTN.Position = UDim2.new(0.02, 0, 0, 0)
DiscordBTN.BackgroundTransparency = 1
DiscordBTN.TextColor3 = Color3.fromRGB(99, 99, 99)
DiscordBTN.TextSize = 12
DiscordBTN.Parent = Discord

local GetKey = Instance.new("Frame")
GetKey.Name = "Frame"
GetKey.Size = UDim2.new(0, 101, 0, 33)
GetKey.Position = UDim2.new(0.136, 0, 0.464, 0)
GetKey.BackgroundColor3 = Color3.fromRGB(47, 47, 47)
GetKey.Parent = Container
applyUICorner(GetKey, 8)
applyUIStroke(GetKey)

local GetKeyBTN = Instance.new("TextButton")
GetKeyBTN.Name = "Frame"
GetKeyBTN.Text = "Get Key"
GetKeyBTN.Size = UDim2.new(0, 100, 0, 33)
GetKeyBTN.Position = UDim2.new(0.01, 0, 0, 0)
GetKeyBTN.BackgroundTransparency = 1
GetKeyBTN.TextColor3 = Color3.fromRGB(99, 99, 99)
GetKeyBTN.TextSize = 12
GetKeyBTN.Parent = GetKey

local Validate = Instance.new("Frame")
Validate.Name = "Validate"
Validate.Size = UDim2.new(0, 101, 0, 33)
Validate.Position = UDim2.new(0.399, 0, 0.464, 0)
Validate.BackgroundColor3 = Color3.fromRGB(47, 47, 47)
Validate.Parent = Container
applyUICorner(Validate, 8)
applyUIStroke(Validate)

local ValidateBTN = Instance.new("TextButton")
ValidateBTN.Name = "ValidateBTN"
ValidateBTN.Text = "Validate"
ValidateBTN.Size = UDim2.new(0, 100, 0, 33)
ValidateBTN.Position = UDim2.new(0.01, 0, 0, 0)
ValidateBTN.BackgroundTransparency = 1
ValidateBTN.TextColor3 = Color3.fromRGB(99, 99, 99)
ValidateBTN.TextSize = 12
ValidateBTN.Parent = Validate

GetKeyBTN.MouseButton1Click:Connect(function()
	setclipboard("facilitykey.org")
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = "Facility Key",
		Text = "Key Link Copied",
		Icon = "rbxassetid://1234567890",
	})
end)

DiscordBTN.MouseButton1Click:Connect(function()
	setclipboard("https://discord.gg/jTuXv2Kcsn")
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = "Facility Key",
		Text = "Discord Link Copied",
		Icon = "rbxassetid://1234567890",
	})
end)

Fermerbtn.MouseButton1Click:Connect(function()
	screenGui:Destroy()
end)

ValidateBTN.MouseButton1Click:Connect(function()
	local enteredKey = EnterKey.Text
	if enteredKey == "" or enteredKey == "Enter Key" then
		warn("Please enter a valid key.")
		return
	end

	local response = FacilityLibrary.validateDefaultKey(enteredKey)
	if response == true then
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = "Facility Key",
			Text = "Key Valide",
			Icon = "rbxassetid://1234567890",
		})
		saveKey(enteredKey)
		screenGui:Destroy()
	else
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = "Facility Key",
			Text = "Key Invalid",
			Icon = "rbxassetid://1234567890",
		})
	end
end)

-- Ajout de la fonctionnalit√© Drag
local dragging = false
local dragStart = nil
local startPos = nil

local function makeDraggable(Container)
	Container.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = Container.Position
		end
	end)

	Container.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = input.Position - dragStart
			Container.Position =
				UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)

	Container.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
end

makeDraggable(Container)

return {
	ValidateBTN = ValidateBTN,
	EnterKey = EnterKey,
	FacilityLibrary = FacilityLibrary,
}
